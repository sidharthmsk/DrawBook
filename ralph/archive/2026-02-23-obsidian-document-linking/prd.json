{
  "project": "Drawbook",
  "branchName": "ralph/obsidian-document-linking",
  "description": "Obsidian-style [[Document Name]] linking across all editors with backlinks, autocomplete picker, and interactive link graph",
  "userStories": [
    {
      "id": "US-001",
      "title": "Add document resolve API endpoint",
      "description": "As a developer, I need an API to resolve a document name to its ID for rendering [[links]].",
      "acceptanceCriteria": [
        "GET /api/resolve?name=DocName returns { document: { id, name, type } } for exact name match",
        "Falls back to partial match if no exact match found",
        "Returns { document: null } if no match at all",
        "Skips soft-deleted documents (those with deletedAt)",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": true,
      "notes": "Endpoint is in app/server/index.ts. Uses storage.listDocumentsWithMeta() and filters by name."
    },
    {
      "id": "US-002",
      "title": "Add backlinks API endpoint",
      "description": "As a developer, I need an API to find which documents link to a given document.",
      "acceptanceCriteria": [
        "GET /api/backlinks/:documentId returns { backlinks: [{ id, name, type }] }",
        "Scans all document content for [[docName]] or [[documentId]] patterns",
        "Uses extractText() to get searchable text from each document type",
        "Skips soft-deleted documents and the document itself",
        "Typecheck passes"
      ],
      "priority": 2,
      "passes": true,
      "notes": "Endpoint is in app/server/index.ts. Loads each document and searches for [[name]] or [[id]] patterns."
    },
    {
      "id": "US-003",
      "title": "Add document names list API endpoint",
      "description": "As a developer, I need a lightweight API to list all document names for autocomplete.",
      "acceptanceCriteria": [
        "GET /api/documents/names returns { documents: [{ id, name, type }] }",
        "Only includes non-deleted documents",
        "Returns name from metadata or falls back to document ID",
        "Typecheck passes"
      ],
      "priority": 3,
      "passes": true,
      "notes": "Endpoint is in app/server/index.ts. Simple map over listDocumentsWithMeta()."
    },
    {
      "id": "US-004",
      "title": "Add link graph API endpoint",
      "description": "As a developer, I need an API that returns the full document link graph for visualization.",
      "acceptanceCriteria": [
        "GET /api/link-graph returns { nodes: [{ id, name, type }], edges: [{ source, target }] }",
        "Nodes are all non-deleted documents",
        "Edges are extracted by scanning content for [[DocName]] patterns and resolving to document IDs",
        "Duplicate edges from the same source to same target are deduplicated",
        "Typecheck passes"
      ],
      "priority": 4,
      "passes": true,
      "notes": "Endpoint is in app/server/index.ts. Builds a name-to-ID map, then scans each document for [[links]]."
    },
    {
      "id": "US-005",
      "title": "Create DocumentLink and DocumentPicker components",
      "description": "As a user, I want [[links]] rendered as clickable navigation and a searchable picker to insert them.",
      "acceptanceCriteria": [
        "DocumentLink component resolves a name via /api/resolve and renders a styled clickable link",
        "Broken links (unresolved) show in red with a tooltip",
        "Loading state shows gray styling",
        "renderWithLinks(text) parses [[...]] patterns and returns React elements",
        "DocumentPicker shows a searchable dropdown of all documents from /api/documents/names",
        "Picker supports keyboard navigation (ArrowUp, ArrowDown, Enter, Escape)",
        "Results are cached to avoid repeated API calls",
        "Typecheck passes"
      ],
      "priority": 5,
      "passes": true,
      "notes": "File: app/src/components/DocumentLink.tsx. Uses resolveCache and allDocsCache for performance."
    },
    {
      "id": "US-006",
      "title": "Add document link insertion to MarkdownEditor",
      "description": "As a user, I want to insert [[Document Name]] links in my markdown documents.",
      "acceptanceCriteria": [
        "MarkdownEditor toolbar has a link icon button that opens the DocumentPicker overlay",
        "Selecting a document inserts [[Document Name]] at the cursor position using editor.insertInlineContent",
        "The picker appears as a centered modal overlay",
        "Pressing Escape closes the picker",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 6,
      "passes": true,
      "notes": "In MarkdownEditor.tsx. Uses docPickerOpen state and DocumentPicker from DocumentLink.tsx."
    },
    {
      "id": "US-007",
      "title": "Add document link insertion and preview to KanbanEditor",
      "description": "As a user, I want to insert and see [[links]] in Kanban card descriptions.",
      "acceptanceCriteria": [
        "CardDetailModal has a 'Link' button next to the Description label",
        "Clicking it opens the DocumentPicker overlay",
        "Selecting a document inserts [[Document Name]] at the textarea cursor position",
        "When description contains [[links]], a preview section renders them as clickable DocumentLink components",
        "The preview only appears when [[...]] patterns are detected",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 7,
      "passes": true,
      "notes": "In KanbanEditor.tsx. Uses renderWithLinks for preview and DocumentPicker for insertion."
    },
    {
      "id": "US-008",
      "title": "Add backlinks panel to EditorShell",
      "description": "As a user, I want to see which documents link to the current one.",
      "acceptanceCriteria": [
        "EditorShell topbar has a 'Links' button that shows backlink count in parentheses",
        "Clicking it toggles a collapsible backlinks panel below the topbar",
        "Panel fetches from /api/backlinks/:documentId",
        "Each backlink is a pill-shaped chip with icon, name, and type",
        "Clicking a backlink navigates to that document",
        "Empty state shows helpful text about using [[Document Name]]",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 8,
      "passes": true,
      "notes": "In EditorShell.tsx. Uses backlinksOpen state and fetches on toggle."
    },
    {
      "id": "US-009",
      "title": "Render [[links]] in AI chat responses",
      "description": "As a user, I want [[links]] in AI responses to be clickable.",
      "acceptanceCriteria": [
        "ReactMarkdown in AiChatPanel uses a custom 'p' component",
        "When paragraph text contains [[...]] patterns, renderWithLinks is used",
        "Links resolve and render as clickable DocumentLink components",
        "Non-link paragraphs render normally",
        "Typecheck passes"
      ],
      "priority": 9,
      "passes": true,
      "notes": "In AiChatPanel.tsx. Adds a custom p component to the ReactMarkdown components prop."
    },
    {
      "id": "US-010",
      "title": "Add interactive link graph to Dashboard",
      "description": "As a user, I want to see a visual graph of how my documents are connected via [[links]].",
      "acceptanceCriteria": [
        "Dashboard sidebar has a 'Link Graph' button below Trash",
        "Clicking it shows a canvas-based force-directed graph visualization",
        "Nodes are colored by document type (markdown=blue, kanban=green, excalidraw=orange, tldraw=purple, etc.)",
        "Edges show directional arrows from source to target",
        "Hovering a node highlights it and shows full name",
        "Clicking a node navigates to that document",
        "Nodes can be dragged to rearrange",
        "A legend shows the type-to-color mapping",
        "Clicking 'Home' or searching clears the graph view",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 10,
      "passes": true,
      "notes": "File: app/src/components/LinkGraph.tsx. Uses canvas 2D rendering with a simple force simulation. Dashboard.tsx imports and toggles it via showLinkGraph state."
    },
    {
      "id": "US-011",
      "title": "Add CSS styles for all document linking UI",
      "description": "As a user, I want all link-related UI to be properly styled.",
      "acceptanceCriteria": [
        "doc-link styles: blue color, dashed underline, hover highlight",
        "doc-link--broken styles: red color for unresolved links",
        "doc-picker styles: dark modal overlay, rounded container, search input, scrollable list",
        "editor-backlinks-bar styles: subtle background, pill-shaped backlink chips",
        "kanban-detail__link-btn and kanban-detail__link-preview styles",
        "link-graph styles: header with close button, canvas border, legend with colored dots",
        "Typecheck passes"
      ],
      "priority": 11,
      "passes": true,
      "notes": "All styles are in app/src/index.css at the end of the file."
    }
  ]
}
